<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

<h2>Registrar Usuario</h2>

<form id="registroForm">
    <div class="mb-3">
        <label for="usuario" class="form-label">Usuario</label>
        <input type="text" class="form-control" id="usuario" required>
    </div>

    <div class="mb-3">
        <label for="clave" class="form-label">Clave</label>
        <input type="password" class="form-control" id="clave" required>
    </div>

    <div class="mb-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input type="text" class="form-control" id="nombre">
    </div>

    <div class="mb-3">
        <label for="apellido" class="form-label">Apellido</label>
        <input type="text" class="form-control" id="apellido">
    </div>

    <div class="mb-3">
        <label for="correo" class="form-label">Correo</label>
        <input type="email" class="form-control" id="correo">
    </div>

    <div class="mb-3">
        <label for="rol" class="form-label">Rol</label>
        <select class="form-select" id="rol" required>
            <option value="">Seleccione un rol</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Registrar</button>
</form>

<script>
    // Cargar roles al cargar la página
    window.addEventListener('DOMContentLoaded', () => {
        fetch('/api/roles')
            .then(res => res.json())
            .then(data => {
                const rolSelect = document.getElementById('rol');
                data.forEach(rol => {
                    const option = document.createElement('option');
                    option.value = rol.id;
                    option.textContent = rol.nombre;
                    rolSelect.appendChild(option);
                });
            })
            .catch(err => console.error('Error cargando roles:', err));
    });

    // Manejar envío del formulario
    document.getElementById('registroForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const usuario = document.getElementById('usuario').value;
        const clave = document.getElementById('clave').value;
        const nombre = document.getElementById('nombre').value;
        const apellido = document.getElementById('apellido').value;
        const correo = document.getElementById('correo').value;
        const rolId = document.getElementById('rol').value;

        const usuarioData = {
            usuario: usuario,
            claveHash: clave,
            nombre: nombre,
            apellido: apellido,
            correo: correo,
            rol: {
                id: parseInt(rolId)
            }
        };

        fetch('/api/usuarios', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(usuarioData)
        })
            .then(res => {
                if (!res.ok) throw new Error('Error en la respuesta del servidor');
                return res.json();
            })
            .then(data => {
                alert('Usuario registrado con éxito');
                console.log(data);
                document.getElementById('registroForm').reset();
            })
            .catch(error => {
                console.error('Error al registrar usuario:', error);
                alert('Ocurrió un error al registrar el usuario');
            });
    });
</script>
</body>
</html>
